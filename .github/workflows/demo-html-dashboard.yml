name: ğŸ¨ Dashboard Demo (HTML vs Markdown)

on:
  workflow_dispatch:
    inputs:
      framework:
        description: 'Test Framework to Demo'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - jest
        - playwright
        - junit
      show_comparison:
        description: 'Show side-by-side HTML vs Markdown comparison'
        required: true
        default: true
        type: boolean

jobs:
  demo-jest-comparison:
    runs-on: ubuntu-latest
    if: github.event.inputs.framework == 'all' || github.event.inputs.framework == 'jest'
    strategy:
      matrix:
        include:
          - name: "ğŸ¨ Jest HTML Dashboard"
            test_framework: 'jest'
            report_paths: 'test-output/jest-results.json'
            html_output: true
            setup_cmd: 'cd test-output && npm install && npm test'
            suffix: 'jest-html'
          - name: "ğŸ“ Jest Markdown Report"
            test_framework: 'jest'
            report_paths: 'test-output/jest-results.json'
            html_output: false
            setup_cmd: 'cd test-output && npm install && npm test'
            condition: ${{ github.event.inputs.show_comparison == 'true' }}
            suffix: 'jest-markdown'
          - name: "ğŸ¨ JUnit HTML Dashboard"
            test_framework: 'junit'
            report_paths: 'examples/junit-sample.xml'
            html_output: true
            setup_cmd: 'echo "Using sample JUnit XML for demonstration"'
            suffix: 'junit-html'
          - name: "ğŸ“ JUnit Markdown Report"
            test_framework: 'junit'
            report_paths: 'examples/junit-sample.xml'
            html_output: false
            setup_cmd: 'echo "Using sample JUnit XML for demonstration"'
            condition: ${{ github.event.inputs.show_comparison == 'true' }}
            suffix: 'junit-markdown'
    
    name: ${{ matrix.name }}
    
    steps:
    - name: ğŸ“ Checkout code
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: ğŸ”§ Setup test environment
      run: ${{ matrix.setup_cmd }}
      if: matrix.condition != 'false'

    - name: ${{ matrix.html_output && 'ğŸ¨' || 'ğŸ“' }} Generate Test Metrics (${{ matrix.test_framework }})
      uses: ./
      if: always() && matrix.condition != 'false'
      with:
        report_paths: ${{ matrix.report_paths }}
        test_framework: ${{ matrix.test_framework }}
        html_output: ${{ matrix.html_output }}
        detailed_summary: true
        fail_on_failure: false
        retention_days: 7
        cache_key_prefix: 'demo-${{ matrix.suffix }}'
        artifact_suffix: '${{ matrix.suffix }}'
        
  demo-playwright-comparison:
    runs-on: ubuntu-latest
    if: github.event.inputs.framework == 'all' || github.event.inputs.framework == 'playwright'
    strategy:
      matrix:
        include:
          - name: "ğŸ¨ Playwright HTML Dashboard"
            html_output: true
            suffix: 'playwright-html'
          - name: "ğŸ“ Playwright Markdown Report"
            html_output: false
            condition: ${{ github.event.inputs.show_comparison == 'true' }}
            suffix: 'playwright-markdown'
    
    name: ${{ matrix.name }}
    
    steps:
    - name: ğŸ“ Checkout code
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci

    - name: ğŸ­ Install Playwright Browsers
      run: npx playwright install --with-deps

    - name: ğŸ§ª Run Playwright Tests
      run: npx playwright test --reporter=json
      if: always()
      env:
        PLAYWRIGHT_JSON_OUTPUT_NAME: playwright-results.json

    - name: ${{ matrix.html_output && 'ğŸ¨' || 'ğŸ“' }} Generate Playwright Metrics
      uses: ./
      if: always() && matrix.condition != 'false'
      with:
        report_paths: 'playwright-results.json'
        test_framework: 'playwright'
        html_output: ${{ matrix.html_output }}
        detailed_summary: true
        fail_on_failure: false
        retention_days: 7
        cache_key_prefix: 'demo-${{ matrix.suffix }}'
        artifact_suffix: '${{ matrix.suffix }}'
        
  demo-summary:
    runs-on: ubuntu-latest
    needs: [demo-jest-comparison, demo-playwright-comparison]
    if: always()
    name: ğŸ“Š Demo Summary
    
    steps:
    - name: ğŸ“Š Display Demo Results
      run: |
        echo "ğŸ‰ Dashboard Comparison Demo Completed!"
        echo ""
        echo "âœ… What was demonstrated:"
        echo "  ğŸ¨ HTML Dashboard - Beautiful, interactive, responsive"
        echo "  ğŸ“ Markdown Report - Same structure, GitHub-friendly"
        echo ""
        echo "ğŸ”„ Both formats now show IDENTICAL information:"
        echo "  â€¢ Same test execution details table"
        echo "  â€¢ Same metrics with Current/Previous/Trend columns"
        echo "  â€¢ Same performance insights and slowest tests"
        echo "  â€¢ Same trend indicators and badges"
        echo ""
        echo "ğŸ¯ Choose your preferred format:"
        echo "  â€¢ html_output: true  â†’ Beautiful HTML dashboard"
        echo "  â€¢ html_output: false â†’ Structured markdown report"
        echo ""
        echo "ğŸ“– Complete guide: HTML_OUTPUT_GUIDE.md"
